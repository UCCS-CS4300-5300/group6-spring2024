{% extends 'templates/base_template.html' %}

{% block content %}
<style>
  .card-row {
    max-width: 78%;
    margin: 20px auto;
  }

  .image-container {
    margin: 20px auto;
    max-width: 75%;
  }

  .img-fluid {
    width: 100%;
    height: auto;
    border-radius: 0.25rem;
  }

  .bottom-btn {
    margin-top: 1.5%;
    margin-bottom: 3%;
  }

  @media (max-width: 768px) {
    .image-container {
      max-width: 100%;
    }
  }

  @media (max-width: 364px) {
    .custom-btn-smaller {
      font-size: 0.75rem;
      padding: .25rem .5rem;
    }
  }

  .review-container {
    position: relative;
  }

  .add-review-btn {
    position: absolute;
    right: 135px;
    top: -50px;
  }
</style>

<div class="container text-center">
  <h1 style="margin-top:65px;">{{ item.name }}</h1>

  <div class="image-container">
    <img src="{{ item.image.url }}" class="img-fluid" alt="Item Image">
  </div>

  <h2 class="row justify-content-center text-center mt-4">Reviews</h2> 
  <form method="GET" class="mb-3">
    {{ item_filter.form }}
    <button type="submit" class="btn custom-btn custom-btn-smaller">Search</button>
  </form>

  {% if user.is_superuser %}
    <button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#removeItemModal">Remove Item</button>

    <!-- Modal -->
    <div class="modal fade" id="removeItemModal" tabindex="-1" aria-labelledby="removeItemModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="removeItemModalLabel">Confirm Item Removal</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            Are you sure you want to remove this item?
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <form action="{% url 'remove_item' item.id %}" method="post">
              {% csrf_token %}
              <button type="submit" class="btn btn-danger">Remove Item</button>
            </form>
          </div>
        </div>
      </div>
    </div>
  {% endif %}

  <div class="review-container">
    {% if reviews %}
      {% for review in reviews %}
      <div class="row justify-content-center mb-0">
        <div class="card card-row m-0 position-relative">
          <div class="row">
            <div class="d-flex align-items-center justify-content-center">
              <div class="card-body text-start">
                <h3 class="card-title mb-0">{{ review.user }}</h3>
                <p>{{ review.review }}</p>
                <p>Stars: {{ review.num_stars }}</p>
              </div>
            </div>
          </div>
        </div>
      </div>
      {% endfor %}
    {% else %}
      <div class="row justify-content-center mb-0">
        <div class="card card-row m-0 position-relative">
          <div class="row">
            <div class="col d-flex align-items-center justify-content-center">
              <div class="card-body text-start">
                <h3 class="card-title mb-0">No Reviews exist yet for this Item.</h3> 
              </div>
            </div>
          </div>
        </div>
      </div>
      <a class="btn custom-btn custom-btn-smaller add-review-btn" href="{% url 'add_review_item' %}">Add Review</a>
    {% endif %}
  </div>
</div>
{% endblock %}
